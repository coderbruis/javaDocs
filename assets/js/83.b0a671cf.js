(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{477:function(e,s,a){"use strict";a.r(s);var r=a(2),t=Object(r.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"_1-搭建过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-搭建过程"}},[e._v("#")]),e._v(" 1. 搭建过程")]),e._v(" "),a("h3",{attrs:{id:"_1-1-准备服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-准备服务器"}},[e._v("#")]),e._v(" 1.1 准备服务器")]),e._v(" "),a("p",[e._v("对于RocketMQ集群搭建，首先得准备好至少两台线上服务器（本人使用的是2核8G），对于如何通过“按量付费使用阿里云ECS”，参考本人的文章：")]),e._v(" "),a("p",[a("a",{attrs:{href:""}},[e._v("阿里云ECS按量付费")])]),e._v(" "),a("p",[e._v("最终服务器信息如下：")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("服务器")]),e._v(" "),a("th",[e._v("内存")]),e._v(" "),a("th",[e._v("CPU")]),e._v(" "),a("th",[e._v("IP")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("CentOS 7.3")]),e._v(" "),a("td",[e._v("8G")]),e._v(" "),a("td",[e._v("2核")]),e._v(" "),a("td",[e._v("121.40.xxx.113")])]),e._v(" "),a("tr",[a("td",[e._v("CentOS 7.3")]),e._v(" "),a("td",[e._v("8G")]),e._v(" "),a("td",[e._v("2核")]),e._v(" "),a("td",[e._v("121.40.xxx.145")])])])]),e._v(" "),a("h3",{attrs:{id:"_1-2-为服务器准备java"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-为服务器准备java"}},[e._v("#")]),e._v(" 1.2 为服务器准备Java")]),e._v(" "),a("p",[e._v("在CentOS的服务器上安装JDK环境，可以参考文章：")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/stulzq/p/9286878.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CentOS 7 安装 JAVA环境（JDK 1.8）"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"_1-3-下载并安装rocketmq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-下载并安装rocketmq"}},[e._v("#")]),e._v(" 1.3 下载并安装RocketMQ")]),e._v(" "),a("p",[e._v("下载地址如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("https://archive.apache.org/dist/rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("在Linux环境中，直接通过如下命令即可在Linux中下载：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("wget https://archive.apache.org/dist/rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("在两台服务器的/opt/software目录下分别下载好RocketMQ之后，配置hosts，配置内容如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("121.40.xxx.145 rocketmq-nameserver1\n121.40.xxx.145 rocketmq-master1\n121.40.xxx.113 rocketmq-slave2\n\n121.40.xxx.113 rocketmq-nameserver2\n121.40.xxx.113 rocketmq-master2\n121.40.xxx.145 rocketmq-slave1\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("p",[e._v("分别在两台服务器上对下载好的RocketMQ包进行解压：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("unzip rocketmq-all-4.5.1-bin-release.zip -d /usr/local/rocketmq\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("并同时修改/etc/profile文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("在文件的末尾处添加\nvim /etc/profile\n\nROCKETMQ_HOME=/usr/local/rocketmq/rocketmq-all-4.5.1-bin-release\nPATH=$PATH:$ROCKETMQ_HOME/bin\nexport ROCKETMQ_HOME PATH\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[e._v("修改完成之后，使其配置生效，调用source /etc/profile")]),e._v(" "),a("h3",{attrs:{id:"_1-4-为主从rocketmq集群架构准备配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-为主从rocketmq集群架构准备配置"}},[e._v("#")]),e._v(" 1.4 为主从RocketMQ集群架构准备配置")]),e._v(" "),a("blockquote",[a("p",[e._v("在121.40.xxx.145这台机器上操作")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vim /usr/local/rocketmq/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-a.properties \n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("修改为如下配置内容：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("brokerClusterName=rocketmq-cluster\nbrokerName=broker-a\nbrokerId=0\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SYNC_MASTER\nflushDiskType=ASYNC_FLUSH\nnamesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876\ndefaultTopicQueueNums=4\nautoCreateTopicEnable=true\nautoCreateSubscriptionGroup=true\nlistenPort=10911\nmapedFileSizeCommitLog=1073741824\nmapedFileSizeConsumeQueue=300000\ndiskMaxUsedSpaceRatio=88\nstorePathRootDir=/usr/local/rocketmq/store\nstorePathCommitLog=/usr/local/rocketmq/store/commitlog\nstorePathConsumeQueue=/usr/local/rocketmq/store/consumequeue\nstorePathIndex=/usr/local/rocketmq/store/index\nstoreCheckpoint=/usr/local/rocketmq/store/checkpoint\nabortFile=/usr/local/rocketmq/store/abort\nmaxMessageSize=65536\nbrokerRole=SYNC_MASTER\nflushDiskType=SYNC_FLUSH\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br")])]),a("p",[e._v("然后再修改从节点配置：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vim /usr/local/rocketmq/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-b-s.properties \n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("修改内容具体如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("brokerClusterName=rocketmq-cluster\nbrokerName=broker-b\nbrokerId=1\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\nnamesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876\ndefaultTopicQueueNums=4\nautoCreateTopicEnable=true\nautoCreateSubscriptionGroup=true\nlistenPort=11011\nmapedFileSizeCommitLog=1073741824\nmapedFileSizeConsumeQueue=300000\ndiskMaxUsedSpaceRatio=88\nstorePathRootDir=/usr/local/src/rocketmq/store\nstorePathCommitLog=/usr/local/src/rocketmq/store/commitlog\nstorePathConsumeQueue=/usr/local/src/rocketmq/store/consumequeue\nstorePathIndex=/usr/local/src/rocketmq/store/index\nstoreCheckpoint=/usr/local/src/rocketmq/store/checkpoint\nabortFile=/usr/local/src/rocketmq/store/abort\nmaxMessageSize=65536\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br")])]),a("p",[e._v("随后建立如下几个配置文件，先为master节点建立配置文件，命令如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkdir /usr/local/rocketmq/store/{commitlog,consumequeue,index} -p\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("为slave节点建立配置文件，命令如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkdir /usr/local/src/rocketmq/store/{commitlog,consumequeue,index} -p\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("blockquote",[a("p",[e._v("接着在在121.40.xxx.113这台机器上操作")])]),e._v(" "),a("p",[e._v("配置master")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vim /usr/local/rocketmq/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-b.properties \n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("配置内容如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("brokerClusterName=rocketmq-cluster\nbrokerName=broker-b\nbrokerId=0\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SYNC_MASTER\nflushDiskType=ASYNC_FLUSH\nnamesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876\ndefaultTopicQueueNums=4\nautoCreateTopicEnable=true\nautoCreateSubscriptionGroup=true\nlistenPort=10911\nmapedFileSizeCommitLog=1073741824\nmapedFileSizeConsumeQueue=300000\ndiskMaxUsedSpaceRatio=88\nstorePathRootDir=/usr/local/rocketmq/store\nstorePathCommitLog=/usr/local/rocketmq/store/commitlog\nstorePathConsumeQueue=/usr/local/rocketmq/store/consumequeue\nstorePathIndex=/usr/local/rocketmq/store/index\nstoreCheckpoint=/usr/local/rocketmq/store/checkpoint\nabortFile=/usr/local/rocketmq/store/abort\nmaxMessageSize=65536\nbrokerRole=SYNC_MASTER\nflushDiskType=SYNC_FLUSH\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br")])]),a("p",[e._v("配置slave")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vim /usr/local/rocketmq/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-a-s.properties\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("配置内容如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("brokerClusterName=rocketmq-cluster\nbrokerName=broker-a\nbrokerId=1\ndeleteWhen=04\nfileReservedTime=48\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\nnamesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876\ndefaultTopicQueueNums=4\nautoCreateTopicEnable=true\nautoCreateSubscriptionGroup=true\nlistenPort=11011\nmapedFileSizeCommitLog=1073741824\nmapedFileSizeConsumeQueue=300000\ndiskMaxUsedSpaceRatio=88\nstorePathRootDir=/usr/local/src/rocketmq/store\nstorePathCommitLog=/usr/local/src/rocketmq/store/commitlog\nstorePathConsumeQueue=/usr/local/src/rocketmq/store/consumequeue\nstorePathIndex=/usr/local/src/rocketmq/store/index\nstoreCheckpoint=/usr/local/src/rocketmq/store/checkpoint\nabortFile=/usr/local/src/rocketmq/store/abort\nmaxMessageSize=65536\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br")])]),a("p",[e._v("随后建立如下几个配置文件，先为master节点建立配置文件，命令如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkdir /usr/local/rocketmq/store/{commitlog,consumequeue,index} -p\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("为slave节点建立配置文件，命令如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkdir /usr/local/src/rocketmq/store/{commitlog,consumequeue,index} -p\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"_1-5-修改启动配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-修改启动配置文件"}},[e._v("#")]),e._v(" 1.5 修改启动配置文件")]),e._v(" "),a("p",[e._v("分别在两台机器上修改启动配置文件：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vim /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/bin/runbroker.sh\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("修改runbroker.sh内容，内容如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('...\nJAVA_OPT="${JAVA_OPT} -server -Xms2G -Xmx2G -Xmn1G"\n...\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vim /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/bin/runserver.sh\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("修改runserver.sh内容，内容如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('JAVA_OPT="${JAVA_OPT} -server -Xms2G -Xmx2G -Xmn1G -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("就这样，配置文件的准备工作就完成了。")]),e._v(" "),a("h2",{attrs:{id:"_2-启动rocketmq主从集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动rocketmq主从集群"}},[e._v("#")]),e._v(" 2. 启动RocketMQ主从集群")]),e._v(" "),a("blockquote",[a("p",[e._v("机器145")])]),e._v(" "),a("p",[e._v("先启动NameServer")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cd /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/bin/\nnohup sh mqnamesrv > nameserver.log &\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("随后启动brokera和broker-b-s节点")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cd /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/bin/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("nohup sh mqbroker -c /usr/local/rocketmq/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-a.properties > broker-a-master.log &\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("nohup sh mqbroker -c /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/conf/2m-2s-sync/broker-b-s.properties > broker-b-slave.log &\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("启动完之后，通过jps查看启动进程情况。")]),e._v(" "),a("blockquote",[a("p",[e._v("机器113")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cd /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/bin/\nnohup sh mqnamesrv > nameserver.log &\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("随后启动brokera和broker-b-s节点")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cd /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/bin/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("nohup sh mqbroker -c /usr/local/rocketmq/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-b.properties > broker-b-master.log &\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("nohup sh mqbroker -c /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/conf/2m-2s-sync/broker-a-s.properties > broker-a-slave.log &\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("启动完之后，通过jps查看启动进程情况。")]),e._v(" "),a("h2",{attrs:{id:"_3-安装rocketmq-console"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装rocketmq-console"}},[e._v("#")]),e._v(" 3. 安装RocketMQ-console")]),e._v(" "),a("p",[e._v("在/opt/software目录下运行以下命令：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("git clone https://github.com/apache/rocketmq-externals\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cd rocketmq-externals/rocketmq-console/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("yum -y install maven \n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("进入rocketmq-console同pom.xml目录，运行如下命令进行打包：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mvn clean package -Dmaven.test.skip=true\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vim /opt/software/rocketmq-externals/rocketmq-console/src/main/resources/application.properties\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("修改内用如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("rocketmq.config.namesrvAddr=rocketmq-nameserver1;rocketmq-nameserver2\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("然后进入打好包的target目录下，启动jar")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("java -jar rocketmq-console-ng-1.0.1.jar\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("这样，就可以在rocketmq-console的网页上查看RocketMQ集群状态了。")]),e._v(" "),a("h2",{attrs:{id:"_4-问题配排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-问题配排查"}},[e._v("#")]),e._v(" 4. 问题配排查")]),e._v(" "),a("h3",{attrs:{id:"_4-1-broker节点启动不成功？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-broker节点启动不成功？"}},[e._v("#")]),e._v(" 4.1 broker节点启动不成功？")]),e._v(" "),a("p",[e._v("按配置文件broker-a-s.properties来配置时，发现broker的nohup日志一直没结果，并且报253，去排查~/logs/rocketmqlogs/broker.log，发现报：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Try to start service thread:AllocateMappedFileService started:false lastThread:null\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("并且，启动不了broker节点，发现是由于")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("/usr/local/src/rocketmq/store/{commitlog,consumequeue,index}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("这几个配置文件导致的，")]),e._v(" "),a("p",[e._v("因此删掉/usr/local/src/rocketmq/store和/usr/local/rocketmq/store这两个目录下的文件之后，重新新建这两个目录下的commitlog,consumequeue,index即可，")]),e._v(" "),a("p",[e._v("随后重启broker即可。")]),e._v(" "),a("h3",{attrs:{id:"_4-2-集群数据流向？为啥producer生产了5条消息，consume有时候能消费到，并且只能消费一条，有时候却消费不到？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-集群数据流向？为啥producer生产了5条消息，consume有时候能消费到，并且只能消费一条，有时候却消费不到？"}},[e._v("#")]),e._v(" 4.2 集群数据流向？为啥producer生产了5条消息，consume有时候能消费到，并且只能消费一条，有时候却消费不到？")]),e._v(" "),a("p",[e._v("TODO 待研究...")]),e._v(" "),a("h3",{attrs:{id:"_4-3-rocketmq集群如何查看消息堆积？通过rocketmq控制台发现生产总数大于了消费总数？表示这消息堆积了，为什么会出现消息堆积？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-rocketmq集群如何查看消息堆积？通过rocketmq控制台发现生产总数大于了消费总数？表示这消息堆积了，为什么会出现消息堆积？"}},[e._v("#")]),e._v(" 4.3 RocketMQ集群如何查看消息堆积？通过RocketMQ控制台发现生产总数大于了消费总数？表示这消息堆积了，为什么会出现消息堆积？")]),e._v(" "),a("p",[e._v("TODO 待研究...")])])}),[],!1,null,null,null);s.default=t.exports}}]);