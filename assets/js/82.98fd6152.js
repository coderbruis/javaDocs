(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{476:function(e,s,r){"use strict";r.r(s);var t=r(2),a=Object(t.a)({},(function(){var e=this,s=e.$createElement,r=e._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("RocketMQ版本：4.9.0")]),e._v(" "),r("h2",{attrs:{id:"_1-下载好源码并到入idea中并构建"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载好源码并到入idea中并构建"}},[e._v("#")]),e._v(" 1. 下载好源码并到入IDEA中并构建")]),e._v(" "),r("p",[e._v("详细请看")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://coderbruis.github.io/javaDocs/views/rocketMQ/%5B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%5DRocketMQ-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html#_1-%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD",target:"_blank",rel:"noopener noreferrer"}},[e._v("RocketMQ源码搭建"),r("OutboundLink")],1)]),e._v(" "),r("h2",{attrs:{id:"_2-启动rocketmq-console"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动rocketmq-console"}},[e._v("#")]),e._v(" 2. 启动rocketmq-console")]),e._v(" "),r("p",[e._v("在网上下载好rocketmq-console之后，通过命令：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("mvn clean install \n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("在target包下启动rocketmq-console")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("java -jar rocketmq-console-ng-1.0.0.jar\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("启动之后页面如下：")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-01",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-01.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-01.png",alt:"rocketmq-debug-01"}})])]),e._v(" "),r("p",[e._v("此时还没有启动源码，所以没有集群信息。")]),e._v(" "),r("h2",{attrs:{id:"_3-启动nameserver"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动nameserver"}},[e._v("#")]),e._v(" 3. 启动NameServer")]),e._v(" "),r("p",[e._v("先找到NamesrvController所在目录（namesrv模块下）")]),e._v(" "),r("p",[e._v("启动NameServer之前，需要配置ROCKETMQ_HOME环境变量，用于读取ROCKETMQ目录下的conf等配置文件。所以在IDEA中，需要先配置Environment variables变量：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("ROCKETMQ_HOME=D:\\MyGitHubProject\\rocketmq-sourcecode-analysis\\rocketmq-rocketmq-all-4.9.0\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("如下图：")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-02",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-02.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-02.png",alt:"rocketmq-debug-02"}})])]),e._v(" "),r("p",[e._v("并且需要再rocketmq源码目录下新建一个conf包用于读取配置文件，如下图：")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-03",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-03.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-03.png",alt:"rocketmq-debug-03"}})])]),e._v(" "),r("p",[e._v("broker-a.properties内容如下：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("#所属集群名字\nbrokerClusterName=rocketmq-cluster\n#broker名字，名字可重复,为了管理,每个master起一个名字,他的slave同他,eg:Amaster叫broker-a,他的slave也叫broker-a\nbrokerName=broker-a\n#0 表示 Master，>0 表示 Slave\nbrokerId=0\n#nameServer地址，分号分割\nnamesrvAddr=127.0.0.1:9876\n#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数\ndefaultTopicQueueNums=4\n#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭\nautoCreateSubscriptionGroup=true\n#Broker 对外服务的监听端口,\nlistenPort=10911\n#删除文件时间点，默认凌晨 4点\ndeleteWhen=04\n#文件保留时间，默认 48 小时\nfileReservedTime=120\n#commitLog每个文件的大小默认1G\nmapedFileSizeCommitLog=1073741824\n#ConsumeQueue每个文件默认存30W条，根据业务情况调整\nmapedFileSizeConsumeQueue=300000\n#destroyMapedFileIntervalForcibly=120000\n#redeleteHangedFileInterval=120000\n#检测物理文件磁盘空间\ndiskMaxUsedSpaceRatio=88\n#存储路径  这里报错了！！\n#storePathRootDir=D:\\Developer_SoftWare\\rocketmq-all-4.9.0-bin-release\\store\\broker-a\n#commitLog 存储路径\n#storePathCommitLog=D:\\Developer_SoftWare\\rocketmq-all-4.9.0-bin-release\\store\\broker-a\\commitlog\n#消费队列存储路径存储路径\n#storePathConsumeQueue=D:\\Developer_SoftWare\\rocketmq-all-4.9.0-bin-release\\store\\broker-a\\consumequeue\n#消息索引存储路径\n#storePathIndex=D:\\Developer_SoftWare\\rocketmq-all-4.9.0-bin-release\\store\\broker-a\\index\n#checkpoint 文件存储路径\n#storeCheckpoint=D:\\Developer_SoftWare\\rocketmq-all-4.9.0-bin-release\\store\\checkpoint\n#abort 文件存储路径\n#abortFile=D:\\Developer_SoftWare\\rocketmq-all-4.9.0-bin-release\\store\\abort\n#限制的消息大小\nmaxMessageSize=65536\n#flushCommitLogLeastPages=4\n#flushConsumeQueueLeastPages=2\n#flushCommitLogThoroughInterval=10000\n#flushConsumeQueueThoroughInterval=60000\n#Broker 的角色\n#- ASYNC_MASTER 异步复制Master\n#- SYNC_MASTER 同步双写Master\n#- SLAVE\nbrokerRole=ASYNC_MASTER\n#刷盘方式\n#- ASYNC_FLUSH 异步刷盘\n#- SYNC_FLUSH 同步刷盘\nflushDiskType=ASYNC_FLUSH\n#checkTransactionMessageEnable=false\n#发消息线程池数量\n#sendMessageThreadPoolNums=128\n#拉消息线程池数量\n#pullMessageThreadPoolNums=128\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br"),r("span",{staticClass:"line-number"},[e._v("19")]),r("br"),r("span",{staticClass:"line-number"},[e._v("20")]),r("br"),r("span",{staticClass:"line-number"},[e._v("21")]),r("br"),r("span",{staticClass:"line-number"},[e._v("22")]),r("br"),r("span",{staticClass:"line-number"},[e._v("23")]),r("br"),r("span",{staticClass:"line-number"},[e._v("24")]),r("br"),r("span",{staticClass:"line-number"},[e._v("25")]),r("br"),r("span",{staticClass:"line-number"},[e._v("26")]),r("br"),r("span",{staticClass:"line-number"},[e._v("27")]),r("br"),r("span",{staticClass:"line-number"},[e._v("28")]),r("br"),r("span",{staticClass:"line-number"},[e._v("29")]),r("br"),r("span",{staticClass:"line-number"},[e._v("30")]),r("br"),r("span",{staticClass:"line-number"},[e._v("31")]),r("br"),r("span",{staticClass:"line-number"},[e._v("32")]),r("br"),r("span",{staticClass:"line-number"},[e._v("33")]),r("br"),r("span",{staticClass:"line-number"},[e._v("34")]),r("br"),r("span",{staticClass:"line-number"},[e._v("35")]),r("br"),r("span",{staticClass:"line-number"},[e._v("36")]),r("br"),r("span",{staticClass:"line-number"},[e._v("37")]),r("br"),r("span",{staticClass:"line-number"},[e._v("38")]),r("br"),r("span",{staticClass:"line-number"},[e._v("39")]),r("br"),r("span",{staticClass:"line-number"},[e._v("40")]),r("br"),r("span",{staticClass:"line-number"},[e._v("41")]),r("br"),r("span",{staticClass:"line-number"},[e._v("42")]),r("br"),r("span",{staticClass:"line-number"},[e._v("43")]),r("br"),r("span",{staticClass:"line-number"},[e._v("44")]),r("br"),r("span",{staticClass:"line-number"},[e._v("45")]),r("br"),r("span",{staticClass:"line-number"},[e._v("46")]),r("br"),r("span",{staticClass:"line-number"},[e._v("47")]),r("br"),r("span",{staticClass:"line-number"},[e._v("48")]),r("br"),r("span",{staticClass:"line-number"},[e._v("49")]),r("br"),r("span",{staticClass:"line-number"},[e._v("50")]),r("br"),r("span",{staticClass:"line-number"},[e._v("51")]),r("br"),r("span",{staticClass:"line-number"},[e._v("52")]),r("br"),r("span",{staticClass:"line-number"},[e._v("53")]),r("br"),r("span",{staticClass:"line-number"},[e._v("54")]),r("br"),r("span",{staticClass:"line-number"},[e._v("55")]),r("br"),r("span",{staticClass:"line-number"},[e._v("56")]),r("br"),r("span",{staticClass:"line-number"},[e._v("57")]),r("br"),r("span",{staticClass:"line-number"},[e._v("58")]),r("br"),r("span",{staticClass:"line-number"},[e._v("59")]),r("br"),r("span",{staticClass:"line-number"},[e._v("60")]),r("br")])]),r("p",[e._v("随后启动即可。")]),e._v(" "),r("p",[e._v("提示：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("The Name Server boot success. serializeType=JSON\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("及表明NameServer启动成功。")]),e._v(" "),r("h2",{attrs:{id:"_3-启动broker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动broker"}},[e._v("#")]),e._v(" 3. 启动Broker")]),e._v(" "),r("p",[e._v("同样的，启动Broker前需要为其设置程序参数（Program arguments），指定broker配置文件，此处的配置文件在第二节中已经配置好了。")]),e._v(" "),r("p",[e._v("找到BrokerStartup启动类，选中之后对其启动配置进行修改。")]),e._v(" "),r("p",[e._v("命令如下：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("-c D:\\MyGitHubProject\\rocketmq-sourcecode-analysis\\rocketmq-rocketmq-all-4.9.0\\conf\\broker-a.properties\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("如图：")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-04",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-04.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-04.png",alt:"rocketmq-debug-04"}})])]),e._v(" "),r("p",[e._v("启动之后控制台显示如下内容则表示启动成功：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("The broker[broker-a, 10.22.12.138:10911] boot success. serializeType=JSON and name server is 127.0.0.1:9876\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("NameServer和Broker启动之后，查看rocketmq-console可以看到Broker集群以及注册进来了。")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-05",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-05.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-05.png",alt:"rocketmq-debug-05"}})])]),e._v(" "),r("h2",{attrs:{id:"_5-启动consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动consumer"}},[e._v("#")]),e._v(" 5. 启动Consumer")]),e._v(" "),r("p",[e._v("找到源码example模块下，启动quickstart的Consumer。")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-06",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-06.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-06.png",alt:"rocketmq-debug-06"}})])]),e._v(" "),r("h2",{attrs:{id:"_6-启动producer，生产5条消息"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-启动producer，生产5条消息"}},[e._v("#")]),e._v(" 6. 启动Producer，生产5条消息")]),e._v(" "),r("p",[e._v("生产者启动之后控制台日志：")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-07",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-07.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-07.png",alt:"rocketmq-debug-07"}})])]),e._v(" "),r("p",[e._v("消费者消费的内容日志打印结果：")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-08",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-08.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-08.png",alt:"rocketmq-debug-08"}})])]),e._v(" "),r("p",[e._v("最后再看下rocketmq-console控制台消息的监控结果")]),e._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"rocketmq-debug-09",href:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-09.png"}},[r("img",{attrs:{src:"https://coderbruis.github.io/javaDocs/img/rocketmq/rocketmq-debug-09.png",alt:"rocketmq-debug-09"}})])]),e._v(" "),r("p",[e._v("就这样，本地通过RocketMQ源码来启动NameServer、Broker、Producer、Consumer就已打通了。、")]),e._v(" "),r("Boxx",{attrs:{type:"tip",content:"本站使用「CC BY 4.0」创作共享协议，转载请在文章明显位置注明作者及出处。"}})],1)}),[],!1,null,null,null);s.default=a.exports}}]);